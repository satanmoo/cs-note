# Secure Sockets Layer

- 현재는 TLS(Transport Layer Security)라는 명칭으로 발전

## 동작 방식

- TLS handshake

1. 클라이언트(브라우저 등)이 서버에 메시지 전송(ClientHello)
    - 메시지에는 다음이 포함:
        - 클라이언트가 지원하는 TLS 버전
        - 암호화 스위트
        - 압축 방식
    - 요약하면 클라이언트가 어떤 암호화 방식을 지원하는지 서버에게 알리는 과정
2. 서버가 인증서를 클라이언트에게 전달(ServerHello)
    - 우선 서버가 선택한 TLS 버젼, 암호화 스위트, 압축 방식 등을 전송
    - 그리고 서버가 서버 공개키를 포함한 인증서를 클라이언트에게 전달
        - 인증서는 서버(일반화하면 HTTP 통신 주체)가 공식적으로 검증된 주체임을 공인 CA(Certificate Authority)가 보증해주는 전자 문서
        - 인증서에는 공인 CA의 전자 서명이 포함됨
            - 전자 서명은 다음의 과정으로 생성:
                - 인증서 내용을 SHA-256같은 암호학적 해시 함수로 해시
                - 해시값을 개인키로 암호화
3. 클라이언트가 서버 인증서 검증 및 키 교환
    - 클라이언트는 서버가 보낸 인증서를 검증
        - CA의 공개키로 전자 서명을 복호화해 원래 해시값을 얻음
        - 인증서 내용을 SHA-256으로 해시
            - 어떤 암호학적 해시 알고리즘을 사용하는지도 인증서에 포함됨
        - 두 해시값을 비교해서 일치 여부 확인
            - 인증서 만료 여부 등도 여기서 확인
    - 위 방식을 루트 CA까지 상위 방향으로 따라가면서 검증(Trust Chain)
        - 루트 CA는 일반적인 OS, 브라우저에 탑재되어 있다고 보면 됨
    - 키 교환 방식에 따라 세션키를 암호화해 서버에게 전달
        - 키 교환 방식은 (2번 ServerHello의 암호화 스위트에 포함됨)
            - 예를 들어 RSA면 서버의 공개키로 세션키를 암호화해서 전달
            - 서버는 세션키를 비밀키로 복호화해서 사용
4. 서버와 클라언트는 공통 세션키로 이후 데이터를 암호화
    - 패킷을 가로채도 세션키로 대칭키 암호화된 상태

## 번외

- 공인 CA 인증서말고 Private CA인증서를 인트라넷 용으로 사용하는 경우도 있음
- 무료 CA인증서도 있음
- CA 인증서 획득, 관리, 갱신, 내부 서비스(elb)연동을 위해 aws acm을 써보자.
- CA 전자 서명은 이더리움과 같은 블록체인에서 사용하는 트랜젝션 서명이랑 동일한 원리임
- [chain-of-trust](https://en.wikipedia.org/wiki/Chain_of_trust)
    - 브라우저, OS는 루트 CA만 탑재하면 됨
        - 루트 CA는 매우 엄격하게 보안 관리
    - 역할 분산, 확장성, 유연성
        - 새로운 중간 CA가 생겨도 브라우저나, OS는 영향 받지 않음
        - 삭제도 마찬가지

- 일반적으로 비대칭키 암호화 방식이 대칭키 암호화 방식보다 효율성이 떨어지기 때문에 SSL handshak에서는 비대칭키 암호화를 사용하고, 이후 메시지 전송은 대칭키 암호화 사용
